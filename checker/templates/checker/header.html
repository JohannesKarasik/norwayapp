{% load static %}

<header class="site-header">
  <div class="wrap wrap--header">
    <a href="/" class="logo" style="display:flex; align-items:center; gap:10px; text-decoration:none;">
      <img
        src="{% static 'checker/logo.png' %}"
        alt="RettTekst"
        style="height:340px; width:auto; display:block; max-height:none;"
      >
    </a>

    <div class="header-actions">
      {% if user.is_authenticated %}
        <a class="header-link header-link--settings" href="{% url 'settings' %}">Innstillinger</a>

        <!-- Kontakt (hidden on mobile) -->
        <button type="button" class="header-link header-link--button header-link--contact" onclick="openContactModal()">
          Kontakt
        </button>

      {% else %}
        <!-- Logged out: show nothing on mobile (and we hide these on mobile via CSS below) -->
        <button type="button" class="header-link header-link--button header-link--contact" onclick="openContactModal()">
          Kontakt
        </button>

        <button type="button" class="header-link header-link--button header-link--login" onclick="window.openAuthModal?.()">
          Logg inn
        </button>

        <button type="button" class="header-link header-link--button header-link--register" onclick="window.openRegisterModal?.()">
          Opprett konto
        </button>
      {% endif %}
    </div>
  </div>

  <hr style="border:0;border-top:1px solid var(--border); margin:0;">
</header>

<!-- ✅ SIMPLE CONTACT MODAL -->
<div id="contact-modal" class="contact-modal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="contact-modal__backdrop" onclick="closeContactModal()"></div>

  <div class="contact-modal__card" role="document">
    <button type="button" class="contact-modal__close" aria-label="Lukk" onclick="closeContactModal()">×</button>

    <h3 class="contact-modal__title">Kontakt</h3>
    <p class="contact-modal__text">
      Send oss en e-post på:
      <a class="contact-modal__email" href="mailto:support@rettskrivingsjekk.com">support@rettskrivingsjekk.com</a>
    </p>
  </div>
</div>

<script>
  function openContactModal() {
    const modal = document.getElementById("contact-modal");
    if (!modal) return;
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    document.addEventListener("keydown", onContactModalKeydown);
  }

  function closeContactModal() {
    const modal = document.getElementById("contact-modal");
    if (!modal) return;
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    document.removeEventListener("keydown", onContactModalKeydown);
  }

  function onContactModalKeydown(e) {
    if (e.key === "Escape") closeContactModal();
  }
</script>

<style>
  /* LOCK HEADER HEIGHT */
  .site-header{
    height:72px;
  }

  /* REMOVE CONTENT PADDING ONLY IN HEADER */
  .site-header .wrap{
    padding:0;
  }

  .site-header .wrap--header{
    height:100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    padding:0 20px;
    overflow: visible; /* allow big logo to overflow without increasing header */
  }

  .header-actions{
    display:flex;
    align-items:center;
    gap:14px;
  }

  .header-link{
    color: var(--accent);
    font-weight:600;
    font-size:14px;
    text-decoration:none;
    padding:6px 0;
    background:none;
    border:0;
    cursor:pointer;
  }

  .header-link:hover{
    text-decoration:underline;
  }

  .header-link--button{
    appearance:none;
    -webkit-appearance:none;
  }

  .site-header{
    height:72px;
  }

  .site-header .wrap{
    padding:0;
  }

  .site-header .wrap--header{
    max-width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    padding:0 20px;
    overflow:visible;
  }

  /* ✅ MOBILE BEHAVIOR:
     - Logged in: show ONLY "Innstillinger"
     - Logged out: show NOTHING AND center the logo
  */
  @media (max-width: 640px) {
    /* Hide everything in the actions area by default */
    .header-actions .header-link,
    .header-actions button {
      display: none !important;
    }

    /* Only show the settings link (and this only exists when authenticated) */
    .header-actions .header-link--settings {
      display: inline-flex !important;
      align-items: center;
    }

    /* Center the logo when logged out (no actions visible) */
    body:not(.is-auth) .site-header .wrap--header{
      justify-content: center !important;
    }

    /* Ensure logo doesn't shift the layout */
    .site-header .logo{
      margin: 0 auto !important;
    }
  }

  /* --- GUARANTEE MAIN CONTENT CENTERING (NON-DESTRUCTIVE) --- */
  main,
  main > .wrap,
  body > .wrap{
    margin-inline:auto;
  }

  /* =========================
     ✅ CONTACT MODAL STYLES
     ========================= */
  .contact-modal{
    position: fixed;
    inset: 0;
    display: none;
    z-index: 9999;
  }

  .contact-modal.is-open{
    display: block;
  }

  .contact-modal__backdrop{
    position:absolute;
    inset:0;
    background: rgba(0,0,0,0.45);
  }

  .contact-modal__card{
    position: relative;
    width: min(420px, calc(100% - 32px));
    margin: 120px auto 0;
    background: #fff;
    border-radius: 14px;
    padding: 18px 18px 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25);
  }

  .contact-modal__close{
    position:absolute;
    top: 8px;
    right: 10px;
    border: 0;
    background: transparent;
    font-size: 22px;
    cursor: pointer;
    line-height: 1;
  }

  .contact-modal__title{
    margin: 0 0 8px;
    font-size: 16px;
    font-weight: 700;
  }

  .contact-modal__text{
    margin: 0;
    font-size: 14px;
    line-height: 1.45;
  }

  .contact-modal__email{
    color: var(--accent);
    font-weight: 700;
    text-decoration: none;
  }

  .contact-modal__email:hover{
    text-decoration: underline;
  }
</style>
